machine:
    timezone:
        Asia/Tokyo
    environment:
        IMPORT_PATH: "github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}"

dependencies:
    pre:
        - go get github.com/tools/godep
    override:
        - mkdir -p "${GOPATH}/src/${IMPORT_PATH}"
        - rsync -azC --delete ./ "${GOPATH}/src/${IMPORT_PATH}"

test:
    pre:
        - echo $GOPATH
        - cd ${GOPATH}/src/${IMPORT_PATH} && pwd && godep restore
    override:
        - cd ${GOPATH}/src/${IMPORT_PATH} && go test -v -race ./tests/*
